<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<META NAME="generator" CONTENT="http://txt2tags.org">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<LINK REL="stylesheet" TYPE="text/css" HREF="fancy.css">
<TITLE>TStools说明书</TITLE>
</HEAD><BODY BGCOLOR="white" TEXT="black">
<CENTER>
<H1>TStools说明书</H1>
<FONT SIZE="4"><I>周骋</I></FONT><BR>
<FONT SIZE="4">最后更新：2010年12月13日</FONT>
</CENTER>

<P></P>
<HR NOSHADE SIZE=1>
<P></P>

  <OL>
  <LI><A HREF="#toc1">初识TStools</A>
    <UL>
    <LI><A HREF="#toc2">1.1. TStools的诞生</A>
    <LI><A HREF="#toc3">1.2. TStools的基本思路</A>
    </UL>
  <LI><A HREF="#toc4">使用TStools</A>
  <LI><A HREF="#toc5">深入了解TStools</A>
  </OL>

<P></P>
<HR NOSHADE SIZE=1>
<P></P>

<A NAME="toc1"></A>
<H1>1. 初识TStools</H1>

<A NAME="toc2"></A>
<H2>1.1. TStools的诞生</H2>

<P>
搞数字电视编解码就要跟码流打交道，分析码流的过程中我一直希望把一些繁琐的操作自动化。
虽然公司有码流分析仪，但几个人共用一个仪器总是不方便，并且有些功能码流分析仪也不支持。
</P>
<P>
2009年初，我开发的H.264编码器出现PCR异常，非常需要连续记录PCR值以便分析其变化规律。
码流分析仪只关注像PCR间隔和PCR抖动这样的指标，不能连续输出PCR值。
于是TStools的最初版本诞生了——SVN的日志记录了它版本化的日子：4月1日。
当时有tsana、ts2es和tsflt三个工具，因此叫TStools（TS工具集）——是不是有点BusyBox的味道？
</P>

<UL>
<LI>tsana分析TS包头，如果有PCR就提取并打印出来；
<LI>ts2es借用了同事给的一个函数，实现TS到ES的转换（试了一下，好像功能不对）；
<LI>tsflt可以将码流中指定PID的包打印出来。
</UL>

<P>
第2季度，我负责在公司的EMR平台上开发IP发送功能。
代码缺陷和网络问题都会导致丢包，这种小概率事件可能一夜只发生一次，甚至仅在早上上班的时候出现。
因此准确地捕捉丢包事件，对调试工作会有很大帮助。
但是码流分析仪的软件夜里可能会死机，导致拷机实验失败。
因此我在tsana工具中增加了UDP接收模块，跟踪指定PID的CC值，一旦不连续就把系统时间和CC情况打印出来。
如果想同时分析所有PID的丢包情况就要复杂一些了：
</P>

<UL>
<LI>tsana要同时跟踪每一种PID的CC数值——需要建立一个链表记录所有出现过的PID；
<LI>tsana要知道每个PID的类型——空包和PCR包的CC值是不变的。
</UL>

<P>
即使是完整的实现丢包检测都必须做PSI分析，因此我在这个简单的基础上停下来，开始考虑TStools的架构。
</P>

<A NAME="toc3"></A>
<H2>1.2. TStools的基本思路</H2>

<P>
Hi! This is my test document.
Its content will end here.
</P>

<A NAME="toc4"></A>
<H1>2. 使用TStools</H1>

<P>
Hi! This is my test document.
Its content will end here.
</P>

<A NAME="toc5"></A>
<H1>3. 深入了解TStools</H1>

<P>
Hi! This is my test document.
Its content will end here.
<A HREF="mailto:zhoucheng@tsinghua.org.cn">周骋</A>
</P>

<!-- html code generated by txt2tags 2.6 (http://txt2tags.org) -->
<!-- cmdline: txt2tags tstools.t2t -->
</BODY></HTML>
